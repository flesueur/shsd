<!DOCTYPE html>
<html lang="en">

<head>
  <title>SHSD - Self-Hosting Security Dashboard</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <link rel="stylesheet" href="/../static/style.css">
  <!-- inclure la carte -->
  <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
</head>

<body>
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v1.0.0/leaflet.markercluster.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v1.0.0/MarkerCluster.css' rel='stylesheet' />
  <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v1.0.0/MarkerCluster.Default.css' rel='stylesheet' />

  <!-- menu -->
  <header>
    <div class="navigation-bar">
      <div id="navigation-container">
        <img src="../static/logo.png" alt="shsd" href="index.html">
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#">About</a></li>
        </ul>
      </div>
    </div>
  </header>

  <br>
  <br>

  <div id='map'>
    <br>
    <script>
      L.mapbox.accessToken = 'pk.eyJ1IjoiY3lsaWEiLCJhIjoiY2poNmZwcW1mMDJ4ZTJ3cGc5dmo1NzA1NyJ9.JU-g1DpPB6jTT-tiVYcUgw';

      //------- afficher map + markers
      var pos = {{center_map}};
      console.log(pos);
      var map = L.mapbox.map('map')
        .setView(pos, 5)
        .addLayer(L.mapbox.tileLayer('mapbox.streets'));
      var myLayer = L.mapbox.featureLayer().addTo(map);
      myLayer.loadURL('http://localhost:5000/api/getGeoJSON/user2'); //charge le contenu du // '/api/geoJson/user'

      //------- afficher popup
      map.on('click', 'places', function(e) {
        var coordinates = e.features[0].geometry.coordinates.slice();
        var description = e.features[0].properties.description;
        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
          coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
        }
        new mapboxgl.Popup()
          .setLngLat(coordinates)
          .setHTML(description)
          .addTo(map);
      });

      //------- Changer le curseur quand il est sur un marker
      map.on('mouseenter', 'places', function() {
        map.getCanvas().style.cursor = 'pointer';
      });

      //------- Rechanger le curseur quand il sort du marker
      map.on('mouseleave', 'places', function() {
        map.getCanvas().style.cursor = '';
      });

      //------- Ajouter une légende à la map
      map.legendControl.addLegend('<strong>View of my logs</strong>');

    </script>
  </div>
  <br>
  <br>
  <footer>
    <p> ceci est le footer et sera rempli plus tard</p>
  </footer>
</body>

</html>
